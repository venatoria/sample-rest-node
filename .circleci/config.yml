version: 2
#
# CircleCI Config for eMasters Connection API
# Full CI/CD Workflow
# Can extend later if needed
jobs:
     # The build job
     build:
          working_directory: ~/app
          docker:
               #- image: circleci/node:10-browsers
               - image: docker:17.05.0-ce-git
          steps:
               - checkout
               - setup_remote_docker
               - run:
                    name: building image
                    command: docker build -t venatoria/emasters-connection-api .

     # The build job
     deploy:
          docker:
               - image: circleci/node:10-browsers
          steps:
               - run:
                    name: Deploying to EC2
                    # All deployement steps are in one file included
                    # deploy.sh will fetch code, run docker, and launch app.
                    command:  ls
                    #command: ssh -o StrictHostKeyChecking=no ubuntu@ec2-18-191-199-62.us-east-2.compute.amazonaws.com "cd ~/proak-dota2; sh deploy.sh"

workflows:
     version: 2
     build_and_deploy:
          jobs:
               - build
               - deploy
